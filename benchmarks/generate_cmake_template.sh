SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
TEMPLATE="$SCRIPT_DIR/TEMPLATE.cmake"
echo "$SCRIPT_DIR"

if [ ! -f "$TEMPLATE" ]; then
	echo "Error: Template file not found at: $TEMPLATE"
	exit 1
fi

for dir in $(find "$SCRIPT_DIR" -mindepth 1 -maxdepth 1 -type d); do
	SUBDIR=$(basename "$dir")
	if [ "$SUBDIR" == "maps" ]; then
		continue
	fi
	DEST="$dir/CMakeLists.txt"
	cp "$TEMPLATE" "$DEST"
	sed -i "s/XXXXXX/$SUBDIR/g" "$DEST"
	sed -i "1s;^;# THIS FILE WAS GENERATED BY $SCRIPT_DIR/$(basename "$0")\n# DO NOT EDIT\n\n;" "$DEST"
done